openapi: 3.0.3
info:
  title: SMO Social API
  description: |
    Comprehensive social media management API for WordPress with enterprise-grade security.
    
    ## Security Features
    
    - **CSRF Protection**: All endpoints require valid CSRF tokens
    - **Input Validation**: Comprehensive validation with sanitization
    - **Authentication**: JWT tokens and API key authentication
    - **Rate Limiting**: Configurable rate limiting per endpoint
    - **Audit Logging**: All API access is logged for security monitoring
    - **Permission Checks**: Role-based access control
    
    ## API Usage
    
    ### Authentication
    ```bash
    # JWT Token Authentication
    Authorization: Bearer your-jwt-token
    
    # API Key Authentication  
    X-API-Key: your-api-key
    X-CSRF-Token: your-csrf-token
    ```
    
    ### CSRF Protection
    ```bash
    # Generate CSRF token
    POST /security/csrf-token
    Content-Type: application/json
    
    {"action": "api_request"}
    
    # Use token in subsequent requests
    X-CSRF-Token: generated-token-here
    ```
    
    ### Rate Limiting
    - 100 requests per 15 minutes per user
    - 1000 requests per hour for authenticated users
    - Rate limit headers included in responses
    
  version: 1.0.0
  contact:
    name: SMO Social Team
    email: support@smo-social.com
  license:
    name: GPL v2
    url: https://www.gnu.org/licenses/gpl-2.0.html

servers:
  - url: https://yoursite.com/wp-json/smo-social/v1
    description: Production server
  - url: http://localhost/wordpress/wp-json/smo-social/v1
    description: Development server

security:
  - BearerAuth: []
  - ApiKeyAuth: []

paths:
  /comments:
    get:
      summary: Get comments with filtering and pagination
      description: Retrieve comments from all connected platforms with advanced filtering options
      parameters:
        - name: platform
          in: query
          description: Filter by specific platform
          schema:
            type: string
            enum: [facebook, instagram, twitter, linkedin, threads, bluesky]
        - name: sentiment
          in: query
          description: Filter by sentiment analysis
          schema:
            type: string
            enum: [positive, neutral, negative]
        - name: is_replied
          in: query
          description: Filter by reply status
          schema:
            type: boolean
        - name: search
          in: query
          description: Search in comment content and author name
          schema:
            type: string
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Successfully retrieved comments
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Comment'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid parameters
        '401':
          description: Unauthorized access

    post:
      summary: Update multiple comments in batch
      description: Bulk update sentiment or other properties for multiple comments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                comment_ids:
                  type: array
                  items:
                    type: integer
                sentiment:
                  type: string
                  enum: [positive, neutral, negative]
                action:
                  type: string
                  enum: [update_sentiment, mark_replied, archive]
      responses:
        '200':
          description: Comments updated successfully
        '400':
          description: Invalid request data

  /comments/{id}:
    get:
      summary: Get a specific comment by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '404':
          description: Comment not found

    put:
      summary: Update a comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentUpdate'
      responses:
        '200':
          description: Comment updated successfully
        '404':
          description: Comment not found

    delete:
      summary: Delete a comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Comment deleted successfully
        '404':
          description: Comment not found

  /comments/{id}/reply:
    post:
      summary: Reply to a comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reply_content:
                  type: string
                  maxLength: 500
                platform:
                  type: string
                  enum: [facebook, instagram, twitter, linkedin, threads, bluesky]
      responses:
        '200':
          description: Reply sent successfully
        '400':
          description: Invalid reply content
        '404':
          description: Comment not found

  /platforms:
    get:
      summary: Get all connected platforms
      responses:
        '200':
          description: List of connected platforms
          content:
            application/json:
              schema:
                type: object
                properties:
                  platforms:
                    type: array
                    items:
                      $ref: '#/components/schemas/Platform'

  /analytics/scores:
    get:
      summary: Get user analytics scores
      description: Get performance scores and analytics for comment management
      parameters:
        - name: user_id
          in: query
          description: Specific user ID (defaults to current user)
          schema:
            type: integer
        - name: date_range
          in: query
          description: Date range for analytics
          schema:
            type: string
            enum: [today, week, month, year]
            default: week
      responses:
        '200':
          description: Analytics scores retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  scores:
                    type: array
                    items:
                      $ref: '#/components/schemas/Score'

  /security/session:
    get:
      summary: Get current session information
      responses:
        '200':
          description: Session information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionInfo'

  /security/csrf-token:
    post:
      summary: Generate CSRF token
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                  description: Action for the CSRF token
      responses:
        '200':
          description: CSRF token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  expires_at:
                    type: string
                    format: date-time

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for service authentication

  schemas:
    Comment:
      type: object
      required: [id, content, author_name, platform, sentiment, created_at]
      properties:
        id:
          type: integer
          description: Unique comment identifier
        content:
          type: string
          description: Comment content
        author_name:
          type: string
          description: Comment author name
        author_id:
          type: string
          description: Platform-specific author ID
        platform:
          type: string
          enum: [facebook, instagram, twitter, linkedin, threads, bluesky]
          description: Social media platform
        post_id:
          type: string
          description: Platform-specific post ID
        sentiment:
          type: string
          enum: [positive, neutral, negative]
          description: AI-analyzed sentiment
        confidence_score:
          type: number
          minimum: 0
          maximum: 1
          description: Sentiment analysis confidence
        is_replied:
          type: boolean
          description: Whether a reply has been sent
        reply_content:
          type: string
          description: Content of the reply sent
        created_at:
          type: string
          format: date-time
          description: Comment creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
        metadata:
          type: object
          description: Platform-specific metadata

    CommentUpdate:
      type: object
      properties:
        sentiment:
          type: string
          enum: [positive, neutral, negative]
        is_replied:
          type: boolean
        custom_fields:
          type: object
          description: Custom fields for extensibility

    Platform:
      type: object
      required: [slug, name, enabled]
      properties:
        slug:
          type: string
          description: Platform identifier
        name:
          type: string
          description: Human-readable platform name
        enabled:
          type: boolean
          description: Whether the platform is enabled
        connected:
          type: boolean
          description: Whether currently connected
        last_sync:
          type: string
          format: date-time
          description: Last synchronization timestamp
        api_version:
          type: string
          description: API version being used

    Score:
      type: object
      required: [platform, date, total_score]
      properties:
        platform:
          type: string
        date:
          type: string
          format: date
        total_score:
          type: number
          description: Overall performance score (0-100)
        comments_sent:
          type: integer
          description: Number of comments processed
        consistency_score:
          type: number
          description: Consistency in replying (0-100)
        speed_score:
          type: number
          description: Response speed score (0-100)
        habits_score:
          type: number
          description: Reply habits score (0-100)
        created_at:
          type: string
          format: date-time

    SessionInfo:
      type: object
      properties:
        active:
          type: boolean
          description: Whether session is active
        session_id:
          type: string
          description: Current session ID
        ip_address:
          type: string
          description: Client IP address
        user_agent:
          type: string
          description: Client user agent
        created_at:
          type: string
          format: date-time
        last_activity:
          type: string
          format: date-time
        lifetime:
          type: integer
          description: Session lifetime in seconds

    Pagination:
      type: object
      properties:
        current_page:
          type: integer
          description: Current page number
        total_pages:
          type: integer
          description: Total number of pages
        total_items:
          type: integer
          description: Total number of items
        per_page:
          type: integer
          description: Items per page
        has_next:
          type: boolean
          description: Whether there is a next page
        has_previous:
          type: boolean
          description: Whether there is a previous page

    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: integer
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details
        timestamp:
          type: string
          format: date-time

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 401
            message: "Authentication required"
            timestamp: "2025-11-22T15:34:00Z"

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 403
            message: "Insufficient permissions"
            timestamp: "2025-11-22T15:34:00Z"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 404
            message: "Resource not found"
            timestamp: "2025-11-22T15:34:00Z"

    RateLimitExceeded:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          description: Request limit per window
          schema:
            type: integer
        X-RateLimit-Remaining:
          description: Remaining requests
          schema:
            type: integer
        X-RateLimit-Reset:
          description: Time when limit resets
          schema:
            type: integer
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            code: 429
            message: "Rate limit exceeded"
            timestamp: "2025-11-22T15:34:00Z"