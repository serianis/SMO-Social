{
    "manifest_version": "1.0",
    "driver_id": "smo_instagram_driver",
    "name": "Instagram",
    "type": "visual_social",
    "icon": "assets/icons/instagram.svg",
    "api_docs": "https://developers.facebook.com/docs/instagram-api",

    "capabilities": {
        "text": true,
        "image": true,
        "video": true,
        "link_preview": false,
        "max_chars": 2200,
        "max_images": 10,
        "allows_html": false,
        "best_image_ratio": "1:1"
    },

    "config_ui": [
        {
            "key": "ig_app_id",
            "label": "App ID",
            "type": "text",
            "required": true,
            "help_text": "Your Instagram App ID from Facebook Developers"
        },
        {
            "key": "ig_app_secret",
            "label": "App Secret",
            "type": "password",
            "required": true,
            "encrypt": true,
            "help_text": "Your Instagram App Secret (will be encrypted)"
        },
        {
            "key": "ig_access_token",
            "label": "Access Token",
            "type": "password",
            "required": true,
            "encrypt": true,
            "help_text": "Long-lived access token with instagram_basic and pages_show_list permissions"
        },
        {
            "key": "ig_business_account_id",
            "label": "Business Account ID",
            "type": "text",
            "required": true,
            "help_text": "Your Instagram Business Account ID"
        }
    ],

    "validation_rules": {
        "warnings": [
            {
                "condition": "content_length > 2200",
                "message": "Instagram captions support up to 2,200 characters, but first 125 are most important."
            },
            {
                "condition": "image_count > 10",
                "message": "Instagram allows maximum 10 images in a carousel post."
            },
            {
                "condition": "video_length > 60",
                "message": "Instagram videos should be under 60 seconds for optimal engagement in feed."
            },
            {
                "condition": "image_ratio == '16:9'",
                "message": "Instagram performs best with square (1:1) or vertical (4:5) images."
            }
        ]
    },

    "api_interaction": {
        "auth_method": "oauth_2.0",
        "auth_endpoint": {
            "url": "https://www.facebook.com/v18.0/dialog/oauth",
            "method": "GET",
            "payload": {
                "client_id": "{{config.ig_app_id}}",
                "redirect_uri": "{{config.ig_redirect_uri}}",
                "scope": "instagram_basic,pages_show_list",
                "state": "{{state}}"
            }
        },
        
        "post_endpoint": {
            "url": "https://graph.facebook.com/v18.0/{{config.ig_business_account_id}}/media",
            "method": "POST",
            "headers": {
                "Authorization": "Bearer {{config.ig_access_token}}",
                "Content-Type": "application/json"
            }
        },

        "payload_map": {
            "caption": "{{post_content}} {{post_hashtags}}",
            "media_type": {
                "if": "{{has_videos}}",
                "structure": "VIDEO"
            },
            "video_url": {
                "if": "{{has_videos}}",
                "structure": "{{video_url}}"
            },
            "image_url": {
                "if": "{{has_images}}",
                "structure": "{{image_url}}"
            }
        }
    },

    "optimal_posting_times": ["11:00", "14:00", "17:00", "19:00", "21:00"],
    "engagement_factors": {
        "text_length": 0.8,
        "hashtags": 1.2,
        "media": 2.5,
        "time_of_day": 1.4,
        "day_of_week": 1.0
    },
    "trending_hashtags_source": "https://www.instagram.com/explore/tags/",
    "notes": "Visual-first platform with Stories, Reels, and IGTV support for business accounts"
}