# SMO Social Branding Manager 403 Forbidden Error - Troubleshooting Guide

## Problem Summary
You're encountering a 403 Forbidden error when trying to access the SMO Social branding settings page at:
`https://facediscussion.s6-tastewp.com/wp-admin/admin.php?page=smo-branding`

## Root Cause Analysis
After comprehensive analysis, the primary issue was that the **BrandingManager** class was never instantiated during plugin initialization, causing the admin menu hooks to never be registered.

## Fixes Applied

### 1. ✅ BrandingManager Initialization
**File**: `includes/Core/Plugin.php`
- Added BrandingManager instantiation in the plugin initialization process
- Added proper error handling and logging
- Ensures the admin_menu hooks are properly registered

### 2. ✅ Database Tables Creation
**File**: `includes/Core/Activator.php`
- Added branding settings table creation during plugin activation
- Added license table creation during plugin activation
- Ensures required database tables exist

### 3. ✅ Diagnostic Script
**File**: `branding_diagnostic.php`
- Comprehensive diagnostic tool to identify all potential issues
- Checks plugin status, class loading, menu registration, database tables, and user permissions
- Provides automatic fixes for common issues

## Verification Steps

### Step 1: Run Diagnostic Script
1. Upload `branding_diagnostic.php` to your WordPress root directory
2. Access it via browser: `https://facediscussion.s6-tastewp.com/branding_diagnostic.php`
3. Review the diagnostic results
4. Use any automatic fix buttons if needed

### Step 2: Test Admin Menu Access
1. Log in to WordPress admin as an administrator
2. Look for "SMO Social" menu in the admin sidebar
3. Check if "Branding" or "White Label Settings" appears as a submenu item
4. Try clicking on the branding menu item

### Step 3: Verify Database Tables
The diagnostic script will show if these tables exist:
- `wp_smo_branding_settings`
- `wp_smo_licenses`

### Step 4: Check User Permissions
Ensure you're logged in as a user with administrator privileges or `manage_options` capability.

## Common Issues & Solutions

### Issue 1: "BrandingManager class not found"
**Solution**: 
- Check if `includes/WhiteLabel/BrandingManager.php` exists
- Verify file permissions
- Ensure the plugin files are complete

### Issue 2: "Branding menu not registered"
**Solution**:
- The fix in `Plugin.php` should resolve this
- If still not working, try deactivating and reactivating the plugin

### Issue 3: "Database tables missing"
**Solution**:
- Use the diagnostic script's "Create Missing Tables" button
- Or manually trigger plugin reactivation

### Issue 4: "User lacks manage_options capability"
**Solution**:
- Log in as Administrator
- Check user role in WordPress admin
- Ensure the user has full administrative privileges

### Issue 5: "WordPress version too old"
**Solution**:
- Update WordPress to version 5.0 or higher
- Check WordPress requirements in plugin documentation

## Advanced Troubleshooting

### Manual Menu Registration Test
Add this code to your theme's `functions.php` temporarily to test:

```php
function test_branding_menu() {
    if (class_exists('SMO_Social\\WhiteLabel\\BrandingManager')) {
        echo "BrandingManager class exists";
        $manager = new \SMO_Social\WhiteLabel\BrandingManager();
        echo "BrandingManager instantiated";
    } else {
        echo "BrandingManager class not found";
    }
}
add_action('admin_notices', 'test_branding_menu');
```

### Database Table Creation Test
If tables are missing, manually run this SQL in phpMyAdmin:

```sql
CREATE TABLE `wp_smo_branding_settings` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `setting_key` varchar(100) NOT NULL,
  `setting_value` longtext DEFAULT '',
  `setting_type` varchar(20) NOT NULL DEFAULT 'string',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `setting_key` (`setting_key`)
);

CREATE TABLE `wp_smo_licenses` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `license_key` varchar(255) NOT NULL,
  `license_type` varchar(50) NOT NULL,
  `status` varchar(20) NOT NULL DEFAULT 'active',
  `domain` varchar(255) NOT NULL,
  `expires_at` datetime DEFAULT NULL,
  `activated_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `last_checked` datetime DEFAULT CURRENT_TIMESTAMP,
  `metadata` longtext DEFAULT '',
  PRIMARY KEY (`id`),
  UNIQUE KEY `license_key` (`license_key`),
  KEY `domain_status` (`domain`, `status`)
);
```

### Plugin Reactivation
If all else fails:
1. Deactivate SMO Social plugin
2. Delete plugin files (backup first!)
3. Re-upload plugin files
4. Reactivate plugin

## Prevention Measures

### 1. Proper Plugin Updates
- Always backup before updating
- Test on staging site first
- Monitor error logs after updates

### 2. Environment Monitoring
- Check WordPress and PHP versions
- Monitor plugin compatibility
- Keep backup of database

### 3. Regular Maintenance
- Run diagnostic scripts periodically
- Check admin menu functionality
- Monitor error logs

## Expected Results After Fix

✅ **Branding menu appears** in WordPress admin sidebar under "SMO Social"
✅ **No 403 errors** when accessing the branding page
✅ **Proper page load** with white-label settings interface
✅ **Database tables created** with default settings
✅ **User permissions validated** for administrators

## Support Information

If issues persist after following this guide:

1. **Check Error Logs**: Look in `/wp-content/debug.log` for PHP errors
2. **Browser Console**: Check browser developer tools for JavaScript errors
3. **WordPress Debug**: Enable `WP_DEBUG` in `wp-config.php`
4. **Plugin Conflicts**: Temporarily deactivate other plugins to test

## Files Modified

- ✅ `includes/Core/Plugin.php` - Added BrandingManager initialization
- ✅ `includes/Core/Activator.php` - Added branding tables creation
- ✅ `branding_diagnostic.php` - New diagnostic tool created

---

**Diagnostic Script**: Upload and run `branding_diagnostic.php` for automated troubleshooting.

**Status**: ✅ Fixes implemented and ready for testing